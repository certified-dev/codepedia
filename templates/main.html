{% extends "base.html" %}

{% load static %}

{% block css %}
<style>
#quill-id_body {
  height: 300px;
}
</style>
{% endblock css %}

{% block body %}
<nav class="navbar navbar-expand-sm bg-light  navbar-light">
  <div class="container">
    <a class="navbar-brand" href="{% url 'home' %}">Code</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#mainMenu" aria-controls="mainMenu" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="mainMenu">

      <ul class="nav-bar nav">
       
        {% if '/question' in request.path %}
          <li class="nav-item active">
            <a class="nav-link" href="{% url 'question' %}">Questions</a>
          </li>
        {% else %}
          <li class="nav-item">
            <a class="nav-link" href="{% url 'question' %}">Questions</a>
          </li>
        {%endif%}
        

       {% if '/tags/' in request.path %}
          <li class="nav-item active">
            <a class="nav-link" href="{% url 'tags' %}">Tags</a>
          </li>
        {% else %}
          <li class="nav-item">
            <a class="nav-link" href="{% url 'tags' %}">Tags</a>
          </li>
        {%endif%}
         

        {% if '/ask/' in request.path %}
           <li class="nav-item active">
              <a class="nav-link" href="{% url 'ask_question' %}">Ask</a>
           </li>
        {% else %}
           <li class="nav-item">
              <a class="nav-link" href="{% url 'ask_question' %}">Ask</a>
           </li>
       {%endif%}

       {% if '/users/' in request.path %}
          <li class="nav-item active">
            <a class="nav-link" href="{% url 'users' %}">Users</a>
          </li>
        {% else %}
          <li class="nav-item">
            <a class="nav-link" href="{% url 'users' %}">Users</a>
          </li>
        {%endif%}
            
     </ul>

      {% if user.is_authenticated %}
        <ul class="navbar-nav ml-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="userMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              {{ user.username }}
            </a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userMenu">
              <a class="dropdown-item" href="{% url 'user_profile' user.pk %}"><i class="fas fa-user-circle"></i>&nbsp;Profile</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="{% url 'account_logout' %}"><i class="fas fa-power-off">&nbsp;</i>Log out</a>
            </div>
          </li>
        </ul>
      {% else %}
        <form class="form-inline ml-auto">
          <a href="{% url 'account_login' %}" class="btn btn-outline-secondary">Log in</a>
          <a href="{% url 'account_signup' %}" class="btn btn-primary ml-2">Sign up</a>
        </form>
      {% endif %}
    </div>
  </div>
</nav>

<div class="container-sm mt-3">
  <div class="row">
  <div class="col-md-9">
     {% block content %}
  
     {% endblock %}
  </div>
  <div class="col-md-3">
    
  </div>
  </div>
</div>

{% endblock %}

{% block js %}
<script src="{% static 'vue.js' %}"></script>
<script src="{% static 'axios.min.js' %}"></script>
<script>
function vote(voteType, voted, voteURL) {
  var bodyFormData = new FormData();
  if (voted) {
    bodyFormData.set('vote_type', 'cancel_vote');
  } else {
    bodyFormData.set('vote_type', voteType);
  }
  axios({
    method: 'post',
    url: voteURL,
    data: bodyFormData,
    headers: {'Content-Type': 'multipart/form-data' }
  }).then((response) => {
    var responseVoteType = response.data.vote_type;
    var targetObj;
    if('answer' in this){
      targetObj = this.answer;
    } else {
      targetObj = this;
    }
    if (responseVoteType == 'upvote') {
      targetObj.upvoted = true;
      targetObj.downvoted = false;
    } else if (responseVoteType == 'downvote') {
      targetObj.upvoted = false;
      targetObj.downvoted = true;
    } else {
      targetObj.upvoted = false;
      targetObj.downvoted = false;
    }
    targetObj.points = response.data.points;
  }).catch((error) => {
    // 401: Not logged in (not authorized)
    if(error.message.includes('401')) {
      window.location.href = "/accounts/signup/";
    }
    // We should get here when the request is not
    // POST or the user's trying to vote on their own question. (400)
  });
}

var points = JSON.parse(document.getElementById('points').textContent);
var upvoted = JSON.parse(document.getElementById('upvoted').textContent);
var downvoted = JSON.parse(document.getElementById('downvoted').textContent);

var app = new Vue({
  delimiters: ["[[", "]]"],
  el: '#question',
  data: {
    downvoted: downvoted,
    upvoted: upvoted,
    points: points,
  },
  methods: {
    vote: vote,
    shout: function (){
      alert('hfhfhfhj');
    },
    check: function (type,voted,url){
      alert(url+voted+type);
    }
  }
});
</script>
{% endblock%}

