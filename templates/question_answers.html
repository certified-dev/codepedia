{% extends "main.html" %}

{% load static humanize %}

{% block title %}code | Question{% endblock title %}

 {% block js %}
 <script src="{% static 'vue.min.js' %}"></script>
 <script src="{% static 'axios.min.js' %}"></script>
 {% endblock js %}

{% block content %}

  <div  class="container mb-2 pt-1 pb-1 pl-md-3" style="border:1px solid lightgray;">
      <div class="row">

         <div class="col-12">
            <b class="text-secondary">{{ question.title }}</b> <small><span class="float-right">points:  {{ question.points }} </span></small>
         </div>

         <div class="col-12">
         {% for tag in question.tags.all %}
            <small><a href="{% url 'tag_question' tag.pk %}" class="badge badge-info badge-pill">{{ tag }}</a></small>
         {% endfor %}
         </div>

         <div class="col-12 bg-light" style="border:1px solid lightgray;">
            <small>{{ question.body }}</small>
         </div>

         <div class="col-12">
            <small>
               <b>posted by: </b><a href="#">{{ question.asked_by }}</a>

               {% if not user == question.asked_by %}
                <a href="#">upvote</a>
                <a href="#">downvote</a>
               {% endif %}

               {% if user == question.asked_by %}
               <div class="float-right">
                <a class="ml-2" href="{% url 'update_question' question.pk %}">edit</a>
                <a href="#">delete</a>
                </div>
               {% endif %}
            </small>
         </div>
         <div class="col-12">
            <small>
               <span><b>asked:</b> {{ question.posted_on|naturaltime}}</span> 
            {% if not question.updated_on is None %}
                <span class="float-right"><b>edited:</b>   
               {{ question.updated_on|naturaltime }}</span>
               {% endif %}
            </small>
         </div>

      </div> 
   </div>

   {% for answer in answers %}

   <form method="post" action="{% url 'delete_answer' answer.pk %}" id="delete_answer" onSubmit="return confirm('delete')">
     {% csrf_token %}
    </form>

   <div  class="container mb-1 pt-1 pb-1 pl-md-3" style="border:1px solid lightgray;">
      <div class="row">

         <div class="col-12 bg-light border-left-0 border-right-0" style="border:1px solid lightgray;">
         <small>{{ answer.text }}</small>
         </div>

         <div class="col-12">
            <small>
               <b>answered by: </b><a href="#foo" class="mr-2">{{ answer.answered_by }}</a>
               <span class="mr-2">points: {{ answer.points }}</span>

                  {% if not user == answer.answered_by %}
                  <a href="#">upvote</a>
                  <a href="#">downvote</a>
                  {% endif %}
               
                  {% if user == answer.answered_by %}
                  <a href="{% url 'update_answer' answer.question.pk answer.pk %}">edit</a>
                  <a id="submitted" href=".">delete</a>
                  {% endif %}
                  <a href="#">add comment</a>

                  <div class="float-right">
                  <span><b>posted: </b>{{ answer.posted_on|naturaltime}}</span> {% if not answer.updated is None %}<span><b>edited: </b>{{ answer.updated_on|naturaltime }}</span>{% endif %}
               </div>
            </small>
         </div>

         <div class="col-12">
         </div>

         {% for comment in answer.comments.all %}
             <div class="col-12 bg-light pl-md-4">
             <small>{{ comment }} - <a href="#">{{ comment.posted_by }}</a> | {{ comment.posted_on|naturaltime }}</small>
            </div>
         {% endfor %}

         <div class="col-12 mt-1">
           <form method="post" action="{% url 'reply_answer' answer.pk %}" novalidate>
           {% csrf_token %}
              <div class="row">
                <div class="col-12">
                  <div class="input-group">
                     <input type="text" class="form-control" name="text" id="id_text" placeholder="enter comment" aria-label="">
                     <div class="input-group-append">
                     <button class="btn btn-success" type="submit">Go</button>
                     </div>
                  </div>
                </div>
              </div>
           </form>
         </div>

      </div> 
   </div>
   {% endfor %}

   <div  class="container mb-3">
        <div class="row">
        {% if user.is_authenticated %}

            {% comment %} {% if user_answers.count > 0 %}
               <div class="col-12 p-2">
                  <button type="buttton" class="btn btn-sm btn-primary">Add another answer</button>
               </div>
            {% else %}
            {% endif %} {% endcomment %}
               <div class="col-12 bg-light">
                  <form method="post" action="{% url 'reply_question' question.pk %}" novalidate>
                     {% csrf_token %}
                    <div class="form-group">
                      <label for=""></label>
                      <textarea class="form-control" name="text" id="id_text" rows="3"></textarea>
                      </div>  
                     <button type="submit" class="btn btn-sm btn-primary">Post Your Answer</button>
                  </form>
               </div >

            

        {% else %}
         <div class="col-12">
            <p><a href="{% url 'account_login' %}">login to reply</a></p>
          </div>
        {% endif %}
       </div>
   </div> 

{% endblock %}

